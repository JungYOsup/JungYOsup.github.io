---
title: "NEXT JS"
excerpt: "NEXT JS에 관해서"
categories:
  - next
tags:
  - jekyll
last_modified_at: 2018-07-01T13:00:00+09:00
toc: true
toc_sticky: true
---

## 1. SSR 에 대해서

### 1.1 SSR vs CSR

|             | CSR(Client Side Rendering)                                                                                                                                                                    | SSR(Server Side Rendering)                                                                                                  |
| ----------- | --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | --------------------------------------------------------------------------------------------------------------------------- |
| 대표적인 예 | React.js                                                                                                                                                                                      | Next.js                                                                                                                     |
| 장점        | 서버와 클라이언트 간의 데이터 양과 트래픽 현저히 감소 <br><br> 단 한번의 랜더링만 있으므로, 페이지 이동이 빠름 <br><br> 업데이트시 중복되는 화면은 그대로 두고 업데이트 되는 화면만 바뀜(SPA) | 초기 랜더링 속도가 빠름 <br><br> SEO 사용가능                                                                               |
| 단점        | SEO사용 불가 <br><br> 코드 Spliting으로 초기 랜더링이 느림                                                                                                                                    | 간단한 데이터 수정도 서버를 거쳐야함 <br><br> 연속적인 랜더링을 할 경우 서버 비용 증가 및 과부화로 서버가 터질수 있음테스트 |

### 1.2 SSR vs CCS Rendering 랜더링 차이점

|        | CSR(Client Side Rendering)                                                                                                                                                                                                                                                                                                                                           | SSR(Server Side Rendering)                                                                                                                                                                                                                                                                                                                                                                        |
| ------ | -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| 랜더링 | CSR은 SPA(Single Page Application)로, 클라이언트 사이드에서 HTML을 반환한 후에 JS가 동작하면서 데이터만을 주고 받아서 클라이언트에서 렌더링을 진행하는 것이다. <br><br>유저의 행동에 따라 필요한 부분만 다시 읽어들이기 때문에 SSR보다 빠른 인터랙션이 가능합니다. <br><br> 단, 페이지를 읽고 자바스크립트를 읽고나서 화면을 그리기 때문에 초기구동 속도가 느립니다. | SSR은 사용자가 웹페이지에 접근할 때, 서버에 각각의 페이지에 대한 요청을 하여 HTML,JS 등을 다시 다운로드 하여 화면에 렌더링하는 방식이다. <br><br>CSR과 비교하여 초기 구동속도가 빠르다는 장점이 있지만, 모든 요청에 관해 필요한 부분만 렌더링하는 것이 아니라 전체 페이지를 렌더링하기 때문에 불필요한 작업이 발생한다. <br><br> 그러나 Next.js에서는 REACT 프레임워크이기 때문에 SPA + SSR 이다. |

### 1.3 SSR 과 CSS의 랜더링 동작 방식

<img src="/assets/images/next_img/rendering.PNG" alt="랜더링"/>

### 1.3 왜? SSR이 검색엔진(SEO)에 최적화 일까?

> 네이버나, 구글이나, 다음 같은 곳에서 우리의 사이트를 검색했을때 우리의 사이트를 제대로 수집하기 위해서는 검색엔진에 최적화 되어야하는데, SSR이 검색엔진에 최적화라고 한다.
>
> 그 이유는 서버에서 클라이언트 대신 랜더링을 해주기 떄문이다.
>
> 클라이언트 대신 서버에서 랜더링 해주는게 왜 검색엔진에 최적화일까?
>
> 클라이언트에서 랜더링 하게 되면, 위에서 랜더링 방식에서 보듯이 빈 HTML을 반환후 -> JS 동작 -> 완성된 화면을 랜더링 하기 때문에 검색시 늦게 검색리스트에 뜰수 있다.
>
> 그러나 서버에서 랜더링을 하면, HTML을 다운로드 받고 바로 화면을 유저한테 바로 보여주기 때문에, 검색시 빠르게 검색리스트에 뜰수 있다.

### 1.4 SSR과 CSR로 본 REACT와 NEXT의 장 단점

![SSR VS CSR 그리고 NEXT]("https://medium.com/@msj9121/next-js-%EC%A0%9C%EB%8C%80%EB%A1%9C-%EC%95%8C%EA%B3%A0-%EC%93%B0%EC%9E%90-8727f76614c9")

### 1.5 그러면 언제 REACT를 사용하고 언제 NEXT를 사용할까?

> REACT는 컴퓨터 성능보다 떨어지는 모바일 앱 만들때 사용하는것을 추천한다.
>
> 자사에서만 사용할 홈페이지 만들때는 어차피 검색 될 필요가 많이 없으므로 REACT를 사용한다.
>
> 구글이나 네이버 , 다음에서 검색되어야할 것들은 NEXT로 제작해야한다.

## 2. Next.JS

### 2.1 Next.JS란

> Next.JS란, REACT Framework로써 SSR(server side rendering)을 가능하게 하고 , 코드 스플리터링을 해준다.
>
> REACT Framework이기 때문에 SPA이기도 하지만 , SPA는 검색엔진에서 효율지 좋지 못하다. 이를 해결해기 위해 컨텐츠를 넣어서 렌더링을 해줘야 하는데 이것이 SSR 방식이 해결해준다.

### 2.2 Next.js를 사용하는 이유

- **첫째, 코드 스플리터링** : Next.js 프레임워크는 기본적으로 코드스플리팅 기능을 제공하고 있습니다. 예를 들어 React로 무수히 많은 컴포넌트를 가진 웹을 만들었을때, 전체를 다 불러와서 화면을 띄울필요 없이 필요한 페이지만 불러와서 사용할 수 있게 해줍니다 이로인해 로딩속도를 개선할 수 있게 됩니다.

### 2.3 Next.js의 특징

- 각 라우트에 해당하는 파일들은 소문자로 pages 디렉토리에 넣어야한다.

* 라우터를 내장하고 있다, (React 같은경우에는 모듈로 받아서 사용했다.)

### 2.4 페이지 라우팅(Link)

- Link를 통해서 페이지를 이동을 한다.

* Link 컴포넌트를 사용 할 때, react-router 에선 to 를 썼겠지만 여기선 href 라는 점과, 이 컴포넌트 내부에 문자열이 아닌 컴포넌트 혹은 엘리먼트가 있어야합니다.

- Link Style을 해주기 위해서는, Link안에 컴포넌트 혹은 엘리먼트에 스타일을 지정해줘야한다.

* Link를 통해서 이동할경우 CSR(custom side rendering)로 페이지를 가져온다.

```tsx
<Link href="/about">
  <div style={{ background: "black", color: "white" }}>소개</div>
</Link>
```

### 2.5 getInitialProps 메소드

- getInitialProps 이 메소드가 서버사이드에서도 실행될수있고, 클라이언트 사이드에서도 실행될수있는거죠. 심지어 필요에 따라 prefetch 도 될 수 있습니다.

* getInitialProps 에서 실행한 메소드에서 리턴하는 값이 해당 컴포넌트의 props 로 전달된답니다. 파라미터로는 서버측의 req 가 들어갑니다.그렇기에 client 에서의 req 는 undefined 이겠죠.

- 첫번째 예시

```js
const Post = (props) => {
  return (
    <div>
      <h1>{props.from}</h1>
    </div>
  );
};

Post.getInitialProps = ({ req }) => {
  return req
    ? { from: "server" } // 서버에서 실행 할 시
    : { from: "client " }; // 클라이언트에서 실행 할 시
};

export default Post;
```

- 따라서 Post 페이지에 Link를 통해서 들어가게 되면 CSR 이므로 결과값이 "client"가 나오는 반면에 URL을 통해서 들어갈경우 SSR이 발생하여 결과값으로 "server"가 출력된다.

* 두번째 예시

```js
import { useRouter } from "next/router";
import posts from "../../src/data/posts.json";

export default () => {
  const router = useRouter();

  const post = posts[router.query.id];

  return (
    <>
      <h1>{post?.title}</h1>
      <p>{post?.content}</p>
    </>
  );
};
```

- 외부에 json 파일을 가져오고 post 에 넣어준다음에 뿌려준다. 지금의 경우 URL로 통해 이동할경우, CSR로 동작을 하기 때문에, CSR로 동작을 하면
  라이프 사이클이 초기화 -> rendering -> update -> redering 끝 순서 이기 떄문에 윗 코드는 post.title이 존재하지 않는다고 오류가 뜬다. 그래서 post? 이것을 해준이유가 post가 존재할경우 title을 가져온다라는 것으로 문제를 해결해주었다.

![라이프사이클](https://ooeunz.tistory.com/138)
![두번째 예시에 관한 설명](https://coffeeandcakeandnewjeong.tistory.com/5#ch-16)

- 두번쨰 예시를 getinitialProps를 사용하여 SSR으로 동작시키기

```js
import posts from "../../posts.json";

const Post = (props) => {
  return (
    <div>
      <h1>{props.post.title}</h1>
      <p>{props.post.content}</p>
    </div>
  );
};

Post.getInitialProps = ({ query }) => {
  return {
    post: posts[query.id],
  };
};

export default Post;
```

- 이럴경우 서버에서 미리 랜더링을 해준다.
